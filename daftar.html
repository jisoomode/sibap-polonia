<script>
const params = new URLSearchParams(location.search);
const tanggal = params.get("tanggal");

if(!tanggal){
  alert("Tanggal tidak valid");
  location.href="jadwal.html";
}

document.getElementById("tanggalBAP").value = tanggal;

const STORAGE_KEY = "kuotaBAP";
let kuota = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

if(kuota[tanggal] === "penuh"){
  alert("Kuota tanggal ini sudah penuh");
  location.href="jadwal.html";
}

const jenis = document.getElementById("jenis");
const syaratUtama = document.getElementById("syaratUtama");
const pendukung = document.getElementById("pendukung");
const suratPolisi = document.getElementById("suratPolisi");
const halamanPaspor = document.getElementById("halamanPaspor");
const penetapanPengadilan = document.getElementById("penetapanPengadilan");

function resetRequired(){
  suratPolisi.querySelector("input").required = false;
  halamanPaspor.querySelector("input").required = false;
  penetapanPengadilan.querySelector("input").required = false;
}

jenis.onchange = ()=>{
  syaratUtama.classList.remove("hidden");
  pendukung.classList.remove("hidden");

  suratPolisi.classList.add("hidden");
  halamanPaspor.classList.add("hidden");
  penetapanPengadilan.classList.add("hidden");

  resetRequired();

  if(jenis.value==="hilang"){
    suratPolisi.classList.remove("hidden");
    suratPolisi.querySelector("input").required = true;
  }
  if(jenis.value==="rusak"){
    halamanPaspor.classList.remove("hidden");
    halamanPaspor.querySelector("input").required = true;
  }
  if(jenis.value==="perubahan"){
    penetapanPengadilan.classList.remove("hidden");
    penetapanPengadilan.querySelector("input").required = true;
  }
};

document.getElementById("formDaftar").onsubmit = e=>{
  e.preventDefault();
  kuota[tanggal] = "penuh";
  localStorage.setItem(STORAGE_KEY, JSON.stringify(kuota));
  alert("Pendaftaran berhasil");
  location.href="jadwal.html";
};
</script>

